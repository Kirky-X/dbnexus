# DBNexus 权限配置文件
#
# 定义角色-表-操作的权限映射
# 支持通配符 "*" 表示所有表或所有操作

roles:
  # 管理员角色 - 完整访问权限
  admin:
    tables:
      - name: "*"
        operations: ["SELECT", "INSERT", "UPDATE", "DELETE"]

  # 只读角色 -只能查询
  readonly:
    tables:
      - name: "users"
        operations: ["SELECT"]
      - name: "orders"
        operations: ["SELECT"]
      - name: "products"
        operations: ["SELECT"]

  # 普通用户角色 - 有限的读写权限
  user:
    tables:
      - name: "users"
        operations: ["SELECT", "UPDATE"]
      - name: "orders"
        operations: ["SELECT", "INSERT"]
      - name: "profiles"
        operations: ["SELECT", "INSERT", "UPDATE"]

  # 订单管理员角色 - 订单相关完整权限
  orders_manager:
    tables:
      - name: "orders"
        operations: ["SELECT", "INSERT", "UPDATE", "DELETE"]
      - name: "order_items"
        operations: ["SELECT", "INSERT", "UPDATE", "DELETE"]

# =============================================================================
# 权限配置说明
# =============================================================================
#
# 角色 (role):
#   - 每个角色定义了一组可访问的表和操作
#   - 角色名用于 Session.get_session(role) 调用
#
# 表名 (name):
#   - 使用 "*" 表示所有表
#   - 具体表名如 "users", "orders" 等
#
# 操作 (operations):
#   - SELECT: 查询数据
#   - INSERT: 插入数据
#   - UPDATE: 更新数据
#   - DELETE: 删除数据
#
# 权限检查流程:
#   1. Session 创建时绑定角色
#   2. 执行 CRUD 操作前自动检查权限
#   3. 无权限时返回 PermissionDenied 错误
#
# 示例用法:
#   let admin_session = pool.get_session("admin").await?;
#   let user_session = pool.get_session("user").await?;
